@{
    ViewBag.Title = "Create Product";
}

<h2>Create New Product</h2>

@using (Html.BeginForm("Create", "Products", FormMethod.Post, new { id = "productForm", onsubmit = "return validateProductForm()" }))
{
    @Html.AntiForgeryToken()
    
    <div class="form-group">
        <label for="Name">Product Name</label>
        <input type="text" class="form-control" id="Name" name="Name" required onblur="validateName(this)" />
        <span id="nameError" class="text-danger"></span>
    </div>
    
    <div class="form-group">
        <label for="Price">Price</label>
        <input type="number" class="form-control" id="Price" name="Price" step="0.01" min="0" required onchange="validatePrice(this)" />
        <span id="priceError" class="text-danger"></span>
    </div>
    
    <div class="form-group">
        <label for="Stock">Stock Quantity</label>
        <input type="number" class="form-control" id="Stock" name="Stock" min="0" required />
    </div>
    
    <div class="form-group">
        <label for="Description">Description</label>
        <textarea class="form-control" id="Description" name="Description" rows="4" onkeyup="updateCharCount(this)"></textarea>
        <small id="charCount">0 characters</small>
    </div>
    
    <button type="submit" class="btn btn-primary">Create Product</button>
    <a href="@Url.Action("Index")" class="btn btn-secondary">Cancel</a>
</form>

<!-- Inline Validation Scripts -->
<script>
    function validateProductForm() {
        var name = document.getElementById('Name').value;
        var price = document.getElementById('Price').value;
        var stock = document.getElementById('Stock').value;
        
        var isValid = true;
        
        // Name validation
        if (!name || name.length < 3) {
            document.getElementById('nameError').textContent = 'Product name must be at least 3 characters';
            isValid = false;
        } else {
            document.getElementById('nameError').textContent = '';
        }
        
        // Price validation
        var priceNum = parseFloat(price);
        if (isNaN(priceNum) || priceNum <= 0) {
            document.getElementById('priceError').textContent = 'Price must be a positive number';
            isValid = false;
        } else {
            document.getElementById('priceError').textContent = '';
        }
        
        // Stock validation
        var stockNum = parseInt(stock);
        if (isNaN(stockNum) || stockNum < 0) {
            alert('Stock must be a non-negative integer');
            isValid = false;
        }
        
        if (!isValid) {
            return false;
        }
        
        // Show loading indicator
        var btn = document.querySelector('button[type="submit"]');
        btn.disabled = true;
        btn.textContent = 'Creating...';
        
        return true;
    }
    
    function validateName(input) {
        var value = input.value;
        if (value.length < 3) {
            input.style.borderColor = 'red';
        } else {
            input.style.borderColor = 'green';
        }
    }
    
    function validatePrice(input) {
        var value = parseFloat(input.value);
        if (isNaN(value) || value <= 0) {
            input.style.borderColor = 'red';
        } else {
            input.style.borderColor = 'green';
        }
    }
    
    function updateCharCount(textarea) {
        var count = textarea.value.length;
        document.getElementById('charCount').textContent = count + ' characters';
        
        if (count > 500) {
            document.getElementById('charCount').style.color = 'red';
        } else {
            document.getElementById('charCount').style.color = 'black';
        }
    }
</script>

<style>
    .form-group {
        margin-bottom: 20px;
    }
    
    .text-danger {
        color: #dc3545;
        font-size: 0.875em;
    }
    
    input[style*="border-color: red"] {
        border: 2px solid red !important;
    }
    
    input[style*="border-color: green"] {
        border: 2px solid green !important;
    }
</style>

